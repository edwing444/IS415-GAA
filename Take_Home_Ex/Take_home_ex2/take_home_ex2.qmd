---
title: "Take Home Exercise 2: Application of Geospatial Analysis Methods to Discover Thailand Drug Abuse at the Province Level"
author: "edwin tan"
execute: 
  eval: true
  echo: true
  freeze: true
---

# Background

### 1. **Geopolitical Context**

-   Thailand's proximity to the **Golden Triangle** (the region where the borders of Thailand, Laos, and Myanmar meet) is significant as this area is historically known as a major hub for drug production and trafficking, particularly of opium and heroin. More recently, synthetic drugs like methamphetamine have become prevalent.

-   Thailand serves both as a **transit route** for drugs destined for third countries and as a significant **market** for illicit drugs. This geopolitical factor adds complexity to the issue, as it intersects with international drug trafficking networks and the nation's domestic drug use.

### 2. **Transportation Infrastructure**

-   With the continuous development of transportation infrastructure in Thailand, the movement of drugs becomes easier both within the country and across borders. This infrastructure facilitates not only legitimate commerce but also illegal activities, particularly in regions that border drug-producing areas.

-   Analysts should consider transportation routes and **connectivity** between provinces, as these might correlate with higher rates of drug abuse or trafficking activity in certain regions.

### 3. **Prevalence of Drug Use**

-   Globally, drug use is on the rise, and Thailand reflects this trend. With **2.7 million youths** reportedly using drugs, and **300,000** needing drug treatment, it’s clear that drug abuse is a pervasive social problem.

-   A particular focus should be placed on **youth involvement**, especially among **vocational-school students**, as they show a higher incidence of drug abuse compared to secondary-school students. Analysts may want to explore why this demographic is more vulnerable and how their environment (e.g., educational settings, social circles) contributes to the problem.

### 4. **Health, Financial, and Social Impact**

-   Drug abuse has severe **health consequences**, including addiction, overdose, and the spread of infectious diseases (e.g., HIV, hepatitis).

-   The **financial cost** includes both the economic burden on healthcare systems and the loss of productivity, particularly among the youth. Social consequences may include increased crime rates, family breakdowns, and reduced educational and employment opportunities for affected individuals.

-   **Social services** and the **healthcare system** in Thailand are likely under strain, with increasing demands for drug treatment and rehabilitation programs.

### 5. **Geographic Distribution of Drug Use**

-   By analyzing the **geographic distribution** of drug use cases across provinces, one can identify patterns that may suggest localized factors contributing to drug abuse. This may include proximity to trafficking routes, socio-economic disparities, or regional differences in enforcement or education.

-   Analysts should be prepared to look at this distribution in relation to **population density**, economic activity, access to healthcare, and law enforcement effectiveness. Yearly data will also allow for the identification of **trends over time**, such as regions where drug abuse is increasing or decreasing.

### 6. **Policy and Enforcement**

-   Thailand has a strong **anti-drug policy**, including harsh penalties for drug-related offenses. However, the effectiveness of these policies is debatable given the continued rise in drug use. An analyst should consider the impact of these policies, including whether they have driven drug abuse underground or led to unintended consequences, such as higher incarceration rates.

In analyzing this data, it is crucial to contextualize it within **regional geopolitics**, **infrastructure development**, **social factors**, and **government responses**. Mapping drug abuse cases by year and province can help to uncover hotspots, trends, and areas where intervention may be most needed. Understanding the **root causes** of drug abuse among vulnerable populations, particularly youths, is also essential in crafting effective policy recommendations and targeted interventions.

# Installing and loading R packages

```{r}

pacman::p_load(sf, spdep, tmap, tidyverse,sfdep)
```

-   **sf**: This package is used for handling spatial data in R, allowing for operations on simple features (geometric objects).

-   **spdep**: This package provides tools for spatial dependence, including functions for spatial weights and models.

-   **tmap**: A package designed for thematic mapping, making it easy to create static and interactive maps.

-   **tidyverse**: A collection of R packages designed for data science, including `ggplot2`, `dplyr`, and others that simplify data manipulation and visualization.

-   **sfdep**: This package focuses on spatial dependency, providing tools for estimating spatial autocorrelation and conducting related analyses.

# The data

```{r}
drug_data <- read.csv("data/thai_drug_offenses_2017_2022.csv")
```

read a CSV (Comma-Separated Values) file containing data on drug offenses in Thailand from the years 2017 to 2022. Here’s a breakdown of its components and purpose:

```{r}
summary(drug_data)
```

-   **Fiscal Year**:

    -   The `fiscal_year` variable ranges from **2017 to 2022**. This indicates that the dataset covers a total of **6 years** of drug offense data.

    -   The median year is **2020**, and the mean year is also **2020**, suggesting that the data is centered around this time period.

-   **Types of Drug Offenses**:

    -   The `types_of_drug_offenses` variable is categorical (character type) and contains a variety of different drug offenses.

    -   The distribution of types may be analyzed further to determine which types of offenses are most common over the years.

-   **Number of Cases (`no_cases`)**:

    -   The `no_cases` variable indicates the number of drug offense cases recorded in the dataset.

    -   **Minimum**: There are instances with **0 cases**, indicating that in some provinces or years, no drug offenses were reported.

    -   **1st Quartile**: The first quartile (25th percentile) shows that **25% of the cases** had **1 or fewer** offenses, indicating low numbers of cases in a substantial portion of the dataset.

    -   **Median**: The median of **70 cases** suggests that half of the entries reported **70 or fewer offenses**, highlighting a significant number of cases in the upper half.

    -   **Mean**: The average number of cases is **535.3**, which is considerably higher than the median, suggesting that there are some provinces or years with exceptionally high numbers of cases that skew the average upwards.

    -   **3rd Quartile**: The third quartile indicates that **75% of the cases** reported **623 or fewer offenses**, reflecting that a smaller portion of the dataset has a much larger number of offenses.

    -   **Maximum**: The maximum number of cases reported is **17,131**, which indicates a significant outlier. This could represent a specific province or year with particularly high drug offenses that may require further investigation.

-   **Province**:

    -   The `province_en` variable, also categorical, lists the provinces in which the drug offenses occurred. The length of this variable being **7392** indicates that there are multiple entries for different provinces and years.

    -   Analysis of this variable could reveal geographic patterns of drug offenses, helping identify regions that are more heavily impacted by drug issues.

Once the provincial boundaries are loaded into the `thailand_provinces` variable as a Simple Features (sf) object, it can be used for various analyse

```{r}
thailand_provinces<- st_read(dsn="data/geospatial",
                         layer = "tha_admbnda_adm1_rtsd_20220121")
```

```{r}
# Drop the ADM1_TH column
thailand_provinces <- thailand_provinces %>%
  select(-ADM1_TH,-ADM1_REF,-ADM1ALT1EN,-ADM1ALT2EN,-ADM1ALT1TH,-ADM1ALT2EN, -ADM1ALT2TH, -ADM0_TH) %>% 
  rename(province_en = ADM1_EN)

# Drop the province_th column
drug_data <- drug_data %>%
  select(-province_th)
```

I simplify the `thailand_provinces` dataset by removing columns that are not needed for further analysis, thus making the dataset cleaner and more manageable. Also, i rename the `ADM1_EN` column to `province_en`, which contains the province names in English. This provides a clearer and more intuitive column name for future analysis.\
\
Next, I remove the `province_th` column from the `drug_data` dataset, likely because it contains redundant or unnecessary information, especially if the `thailand_provinces` dataset now includes the relevant province information in English. Dropping this column helps streamline the `drug_data` dataset, focusing on the necessary columns that are crucial for the analysis of drug offenses.

```{r}
province_grouped <- drug_data %>%
  group_by(fiscal_year, province_en)

# Example: Summarize the total drug offenses for each group
province_summary <- province_grouped %>%
  summarise(total_offenses = sum(no_cases, na.rm = TRUE), .groups = "keep")
```

This grouping allows for subsequent calculations to be performed within these groups, making it easier to analyze trends and patterns of drug offenses over time and across different provinces.

The result after summarising is a new data frame `province_summary` that contains three columns: `fiscal_year`, `province_en`, and `total_offenses`, which reflects the total number of offenses recorded for each province in each fiscal year.

The argument `.groups = "keep"` retains the grouping structure of the original data frame in the summarized output, which may be useful for further analysis or visualizations.

```{r}
# Join the drug abuse data with province polygons
combined_data <- thailand_provinces %>%
  left_join(drug_data, by = "province_en")

```

Now I will merge the two datasets in a way that retains all the rows from the `thailand_provinces` dataset and includes matching rows from the `drug_data` dataset based on the `province_en` column.

-   If a province in `thailand_provinces` does not have corresponding data in `drug_data`, the resulting `combined_data` will still include that province, but the columns from `drug_data` will contain `NA` (missing values).

The purpose of this operation is to create a combined dataset that integrates geographic information about the provinces with the corresponding drug offense data. This integration is used for mapping the data to **understand how the data looks like**

```{r}
# Join the drug abuse province data with province polygons
combined_province_data <- thailand_provinces %>%
  left_join(province_summary)
```

The above merges the geographic data of provinces with the summarized drug offense data to create a comprehensive dataset that includes both spatial and analytical information.

-   The join is done based on the common columns present in both datasets. Since `province_summary` is assumed to have the `province_en` column, it will merge the summarized drug offense totals for each province.

-   If there are provinces in `thailand_provinces` that do not have corresponding entries in `province_summary`, they will still be included in the resulting dataset (`combined_province_data`), but the columns from `province_summary` will contain `NA` (missing values).

This integration is essential for **spatial analysis and for visualizing the data on maps**.

```{r}
combined_province_data <- combined_province_data %>%
  filter(!is.na(total_offenses))
```

Now I clean the dataset by excluding any entries that do not have a valid total number of drug offenses.

Removing rows with `NA` values in the `total_offenses` column ensures that subsequent analyses or visualizations are based on complete data, leading to more accurate and reliable results.

```{r}
print(st_geometry_type(combined_province_data))
```

It is "MULTIPOLYGON", it signifies that some provinces may consist of multiple, non-contiguous areas.

# Understanding the data

```{r}
# Create a choropleth map using tmap
tm_shape(combined_province_data) +
  tm_polygons("total_offenses", 
              title = "Number of Cases",
              palette = "Blues", 
              style = "quantile", 
              n = 5) +
  tm_facets(by = "fiscal_year", nrow = 2, free.coords = FALSE) +
  tm_layout(main.title = "Drug Offense Cases in Thailand by Province and Fiscal Year",
            main.title.size = 1.5,
            legend.outside = TRUE)
```

#### **1. Spatial Distribution Analysis**

-   **Northern Thailand:**

    -   The consistently high rates of drug offenses in the northern provinces, particularly Chiang Mai, Chiang Rai, and Mae Hong Son, align with the geographical proximity to the *Golden Triangle*, a region where Myanmar, Laos, and Thailand meet and which has historically been a hub for drug production and trafficking, particularly opium and methamphetamines.

    -   These provinces are on critical drug trafficking routes. Both production and cross-border smuggling of drugs likely lead to higher drug-related arrests and offenses in this area.

-   **Southern Thailand:**

    -   The fluctuation between high and low rates of drug offenses in southern provinces like Yala, Pattani, and Narathiwat could be influenced by political instability and insurgency. The region’s volatile security situation might make it easier for criminal networks to operate in some years, while in others, heavy military or police operations may reduce drug-related activity.

    -   The coastal access of southern provinces also suggests the possibility of drug smuggling by sea. Major coastal routes may play a role in the drug trade, with some provinces acting as transit points.

-   **Central Thailand:**

    -   Central Thailand, including the Bangkok metropolitan area, generally shows lower rates of drug offenses compared to the north and south. However, the fluctuation of rates in this area can be attributed to its urban density, economic activity, and the focus on trafficking and distribution rather than production. Law enforcement in urban centers tends to be more rigorous, which may help in keeping offense rates relatively low.

#### **2. Temporal Trends**

-   **2017-2019:**

    -   During this period, most provinces in Thailand experienced a rise in drug offense cases. This may be due to increased trafficking activities or a rise in drug production in neighboring countries.

    -   Another potential factor could be Thailand's more stringent anti-drug measures introduced in these years. If law enforcement efforts intensified, we might expect an initial spike in offenses as more arrests were made.

-   **2020:**

    -   The slight decrease in offenses in some provinces could be linked to COVID-19 lockdown measures, which likely disrupted trafficking routes and limited the mobility of both traffickers and users.

    -   Border closures, particularly with Myanmar and Laos, could have contributed to this decline, as these regions are significant sources of illicit drugs.

-   **2021-2022:**

    -   With data missing for 2022, it's difficult to analyze this year fully. However, the continuation of trends into 2021 suggests a rebound in drug offenses, possibly as COVID-19 restrictions eased. This could indicate a resumption of trafficking activities.

#### **3. Hotspot Analysis**

-   **Northern Provinces:**

    -   Provinces like Chiang Mai, Chiang Rai, and Mae Hong Son are recurrent hotspots for drug offenses, again underscoring their strategic importance in trafficking routes from the *Golden Triangle*. The mountainous terrain and porous borders make monitoring and controlling these regions challenging, allowing for consistent trafficking operations.

-   **Southern Provinces:**

    -   Yala, Pattani, and Narathiwat show elevated rates, especially in certain years. The presence of insurgent groups in these regions may contribute to higher rates of drug offenses, as some of these groups could be involved in the drug trade to fund their activities. Moreover, the difficult security situation in the south complicates law enforcement efforts.

#### **4. Potential Explanations**

-   **Geographical Factors:**

    -   Proximity to drug production areas in Myanmar and Laos is one of the key drivers behind high drug offense rates in northern Thailand. Major highways, rivers, and mountain passes in these areas serve as conduits for the drug trade, with drugs entering Thailand via these borders.

-   **Socioeconomic Conditions:**

    -   Regions with high poverty and unemployment often experience higher rates of drug-related crimes. Individuals in these regions may become involved in drug trafficking as a means of survival, particularly in provinces where economic opportunities are limited. Socioeconomic data for these provinces could provide additional insights into the correlation between poverty and drug offenses.

-   **Governance and Law Enforcement:**

    -   Variations in law enforcement efforts across regions can significantly affect the number of recorded drug offenses. Regions with strong, well-resourced law enforcement may see higher numbers of arrests, as officers are more capable of apprehending offenders. Conversely, provinces with less effective governance or law enforcement may underreport drug activity.

-   **Drug Production and Trafficking Routes:**

    -   Further analysis could focus on the types of drugs that are most prevalent in these regions. Methamphetamine (often trafficked from Myanmar) is the most commonly seized drug in Thailand. Understanding where these drugs are produced, the routes they take to reach distribution points, and the socio-political factors that enable trafficking could refine this analysis.

#### **5. Further Analysis and Next Steps**

-   **Spatial Autocorrelation:**

    -   Conducting a global spatial autocorrelation analysis using Moran’s I could help determine whether drug offenses are spatially clustered or dispersed across Thailand. A local analysis (such as Getis-Ord Gi\*) could then identify specific provinces that function as statistically significant hotspots.

-   **Socioeconomic Data Integration:**

    -   Integrating socioeconomic indicators like income levels, education rates, and unemployment with drug offense data would provide a more comprehensive understanding of the drivers behind the spatial patterns observed. This can be done using methods such as geographically weighted regression (GWR).

-   **Temporal Analysis:**

    -   Conducting a spatio-temporal analysis using techniques like kernel density estimation (KDE) for hot-spot detection over time could reveal changes in offense patterns and how these have evolved in response to events such as policy changes or socio-economic developments.

```{r}
# Example: KDE (if you have point data)
tm_shape(combined_province_data) +
  tm_polygons("total_offenses", 
              title = "Number of Drug Cases", 
              palette = "Oranges", 
              style = "cont") +  # Continuous color scale
  tm_layout(main.title = "KDE Map of Drug Offense Density", 
            legend.outside = TRUE)
```

#### **1. Spatial Clustering**

-   **Northern Thailand:**

    -   The clustering in northern Thailand, particularly around Chiang Mai, Chiang Rai, and Mae Hong Son, is likely driven by its geographical location. This area is part of the *Golden Triangle*, which has historically been a center for opium production and now methamphetamine trafficking. The mountainous terrain and porous borders with Myanmar and Laos make this region an attractive route for traffickers, contributing to consistently high offense rates.

    -   The clustering observed could also be due to the enhanced focus of law enforcement in these regions. Hotspots may emerge not only because of trafficking but due to targeted anti-drug operations by authorities in this area.

-   **Southern Thailand:**

    -   The southern provinces of Yala, Pattani, and Narathiwat also exhibit significant spatial clustering of drug offenses. These provinces are known for political instability and ongoing insurgency, which can create a permissive environment for criminal activities, including drug trafficking.

    -   Additionally, the proximity to maritime routes and porous borders with Malaysia may facilitate smuggling operations, adding to the concentration of drug offenses in this region.

-   **Central Thailand:**

    -   Central Thailand generally shows lower densities of drug offenses, with scattered clusters in some urban areas. This may be because central provinces, including the capital city Bangkok, serve more as distribution hubs rather than centers of drug production or trafficking. Law enforcement is also generally stronger in central Thailand, which could help suppress visible clustering of offenses.

#### **2. Density Gradients**

-   The density gradient maps of drug offenses show a clear geographic divide, with the north and south experiencing much higher densities than the central region. These gradients are visual representations of where drug offenses are most concentrated.

    -   **Darker shades in northern and southern Thailand** indicate high densities of offenses, reflecting the concentration of trafficking routes and the presence of vulnerable populations in these regions.

    -   **Lighter shades in central Thailand** suggest a lower concentration of offenses, potentially due to more effective governance, urban infrastructure, and better socioeconomic conditions.

#### **3. Potential Explanations**

-   **Geographical Factors:**

    -   Northern Thailand’s proximity to the borders of Myanmar and Laos is a critical factor in its role in drug trafficking. Drugs, particularly methamphetamines, are produced in these neighboring countries and trafficked through northern Thailand to other parts of the country and beyond. The challenging terrain and remote border areas make it easier for traffickers to move goods undetected, leading to clusters of drug-related offenses.

    -   In the south, proximity to maritime smuggling routes and the border with Malaysia plays a significant role in the concentration of drug offenses. Maritime routes offer traffickers an alternative to land routes, making it a key transit point for drugs coming from Southeast Asia.

-   **Socioeconomic Conditions:**

    -   High poverty and unemployment in regions like northern and southern Thailand can fuel drug-related activities. People in economically deprived areas may become involved in trafficking and drug-related crimes due to a lack of alternatives for economic survival.

    -   In contrast, the relatively wealthier and more developed central region may see fewer clusters of drug offenses due to better employment opportunities, higher educational attainment, and stronger institutions.

-   **Governance and Law Enforcement:**

    -   The clustering of drug offenses in northern and southern Thailand could be influenced by variations in the effectiveness of law enforcement. In regions where law enforcement is weaker or less present, trafficking routes may flourish, resulting in higher densities of drug offenses.

    -   Conversely, central Thailand may benefit from stronger governance and more rigorous anti-drug initiatives, leading to lower densities of drug offenses. The presence of more robust legal frameworks and security forces in urban areas like Bangkok also contributes to the scattered nature of drug-related offenses in this region.

-   **Drug Production and Trafficking Routes:**

    -   The specific types of drugs and their production and trafficking routes are crucial to understanding these spatial patterns. In northern Thailand, methamphetamine is the primary drug being trafficked from neighboring Myanmar. In southern Thailand, the influence of transnational drug networks and the role of maritime smuggling routes add complexity to the spatial patterns observed. Further analysis of drug types and their transit paths would reveal more about how different trafficking networks operate across the country.

#### **4. Further Analysis**

-   **Spatial Autocorrelation Analysis:**

    -   Performing a spatial autocorrelation test like Moran’s I can statistically confirm the clustering patterns observed in the north and south. A local indicator of spatial association (LISA) could also help to pinpoint specific provinces contributing most to these clusters.

# Preparing data for **Global Measures of Spatial Autocorrelation**

```{r}
#|eval: false
# Create neighbors list
neighbors <- st_contiguity(combined_province_data)
```

I create a **contiguity-based neighbors list** for spatial analysis

`st_contiguity()` is part of the **sfdep** package, which is designed for working with spatial dependencies.

-   **Contiguity** refers to spatial units (in this case, provinces) that share common boundaries. When two provinces share a border, they are considered "neighbors."

-   The function creates a list of neighboring provinces based on their shared borders.

The result is a list where each province has an associated set of neighboring provinces.\

### Save Derived data

```{r}
write_rds(neighbors,"data/rds/neighbors.rds")
```

### Read Derived data

```{r}
neighbors<-read_rds("data/rds/neighbors.rds")
```

```{r}
length(combined_province_data$total_offenses)  # Check the length of your data
length(neighbors)  # Check the number of units in the spatial weights matrix
```

```{r}
listw <- nb2listw(neighbors)
```

Now we convert a **neighbors list** (such as the one I created earlier with `st_contiguity()`) into a **spatial weights matrix** (stored as `listw`). This is an important step in spatial analysis because it allows me to quantify the relationships between geographic units (in this case, provinces) in terms of spatial dependence.

```{r}
# Convert neighbors list to weights list
weights_list <- nb2listw(neighbors, style = "W")
```

This command converts the **neighbors list** into a **spatial weights matrix** (stored as `weights_list`), where the weights are row-standardized. The weights matrix is used for spatial analysis tasks like calculating spatial autocorrelation or running spatial regression models.

# Calculating Moran's I

```{r}
# Calculate Moran's I
moran_result <- moran.test(combined_province_data$total_offenses, listw)
print(moran_result)
```

**Moran's I** is a measure of spatial autocorrelation, which indicates whether values of a variable at nearby locations are more similar or more different than expected by chance. It ranges from -1 to 1

**Moran's I Statistic: 0.1903562142**

-   This value suggests a **weak positive spatial autocorrelation**. In simple terms, it indicates that provinces with higher drug offense rates are **slightly more likely to be near other provinces** with similarly high offense rates, compared to a random distribution. The positive value means that nearby provinces tend to have **similar offense levels**, but since it's close to 0, the spatial relationship is not particularly strong.

-   **Weak autocorrelation** can indicate that, while there is some degree of clustering, the spatial distribution of offenses isn't driven solely by geographic proximity. Other factors, such as socioeconomic conditions, local law enforcement efforts, and specific drug trafficking routes, may play a larger role in shaping these patterns.

**Standard Deviate: 16.077**

-   The standard deviate provides a sense of how far the observed Moran's I statistic is from the expected value under the assumption of random spatial patterns. A standard deviate of **16.077** is quite high, indicating that the observed value is **far from random** and suggests a significant deviation from the null hypothesis of no spatial autocorrelation.

-   This means that even though the spatial autocorrelation is weak, the structure observed is still **statistically significant**.

**p-value: \< 2.2e-16**

-   This **extremely small p-value** (\< 2.2e-16) indicates that the observed Moran's I statistic is **highly unlikely to have occurred by chance**. It provides strong evidence that **spatial clustering is present** in the dataset. Therefore, we can confidently reject the null hypothesis (which assumes no spatial autocorrelation) and conclude that there is some degree of spatial clustering among provinces with higher rates of drug offenses.

**Expectation and Variance**

-   The expectation and variance provide the benchmark for understanding whether the observed Moran's I statistic deviates significantly from random chance. In this case, the strong statistical significance (p-value) indicates that the observed Moran's I value is meaningfully different from what we would expect if there were no spatial autocorrelation.

### Conclusion and Implications

-   **Weak but Significant Spatial Clustering**: Although the Moran’s I statistic indicates only weak positive autocorrelation, the small p-value confirms that the spatial clustering observed is not random. Provinces with high drug offenses tend to **cluster geographically**, but the strength of the clustering effect is not particularly strong.

-   **Geographically Linked Factors**: The weak positive autocorrelation suggests that geographical proximity does play a role, but it's not the only factor influencing the distribution of offenses. Other variables—such as **drug trafficking routes, socio-economic conditions**, and **local governance**—likely contribute to the patterns seen across provinces.

-   **Further Spatial Analysis Needed**: To better understand this weak spatial autocorrelation, additional spatial techniques could be employed:

    -   **Local Indicators of Spatial Association (LISA)**: LISA can help identify local clusters of high or low values and highlight provinces that deviate from the overall trend.

**Conclusion:**

This analysis provides a foundational understanding of the spatial distribution of drug offenses in Thailand and suggests that while proximity plays a role, other non-spatial factors may also significantly contribute to the clustering patterns.

# Global measures of Spatial Association

```{r}
#|eval: false
wm_thai_g <- combined_province_data %>% 
  mutate(nb=st_contiguity(geometry),
         wt=st_weights(nb,
                       style="W"),
         .before = 1)
```

### Save Derived data

```{r}
write_rds(wm_thai_g,"data/rds/wm_thai_g.rds")
```

### Read Derived data

```{r}
wm_thai_g<-read_rds("data/rds/wm_thai_g.rds")
```

## Computing Global Moran'I

global_moran() function is used to compute Moran's I value. Different from sdep package, the output is a tibble data.frame

```{r}
moranI <- global_moran(wm_thai_g$total_offenses,
                       wm_thai_g$nb,
                       wm_thai_g$wt)
glimpse(moranI)
```

### Interpretation of Moran's I Results:

1.  **Moran's I Statistic (\$I\$): 0.19**

    -   This value represents the global Moran's I statistic for the dataset, which is **0.19**. It suggests a **weak positive spatial autocorrelation**. In other words, provinces with **higher drug offense rates** tend to be **slightly more clustered together geographically** than what would be expected under a random distribution.

    -   Although the autocorrelation is positive, it's relatively weak, implying that while some clustering is present, it is not a strong spatial dependency.

2.  **Z-Score (\$K\$): 21.8**

    -   The **Z-score** of **21.8** provides a standardized measure of how far the observed Moran's I value is from what would be expected under a null hypothesis of no spatial autocorrelation.

    -   A Z-score of 21.8 is **extremely high**, indicating that the observed spatial autocorrelation is **highly statistically significant** and is not likely to have occurred by random chance. This strongly supports the existence of spatial clustering in the data.

### Conclusion:

The analysis reveals a **statistically significant but weak positive spatial autocorrelation** in the distribution of drug offenses across the provinces. While the clustering is not particularly strong, it is **unlikely to be random** and suggests that there are **underlying spatial processes** at work. These processes could include factors such as **geographical proximity to drug trafficking routes, socioeconomic conditions**, or **differences in law enforcement practices** across regions. Further analysis could focus on identifying these factors more clearly through **local spatial analysis** and **geographically weighted regression**.

## Performing Global Moran's I test

```{r}
global_moran_test(wm_thai_g$total_offenses,
                       wm_thai_g$nb,
                       wm_thai_g$wt)
```

```{r}
global_moran_perm(wm_thai_g$total_offenses,
                       wm_thai_g$nb,
                       wm_thai_g$wt,
                  nsim = 99)
```

**Output Interpretation:**

1.  **P-value: \< 2.2e-16**

    -   This **extremely small p-value** indicates that the observed spatial autocorrelation is **highly statistically significant**. Given that the p-value is far below common thresholds (e.g., 0.05 or 0.01), we can confidently **reject the null hypothesis** of no spatial autocorrelation. This means that the observed spatial distribution of drug offenses is not random.

2.  **Interpretation of the Hypothesis Test:**

    -   The **alternative hypothesis** here is that there is **positive spatial autocorrelation** in the data. Since the **Moran's I** value is positive (0.19) and the p-value is extremely low, there is strong evidence to support the conclusion that **provinces with similar levels of drug offenses tend to be located near each other**.

    -   In other words, areas with high offense rates are more likely to be near other areas with high offense rates, and the same applies to areas with lower rates.

3.  **Moran's I Statistic: 0.1903562142**

    -   The **Global Moran's I** of **0.19** suggests a **weak positive spatial autocorrelation**. This implies that there is some clustering of provinces with similar drug offense levels, but the strength of this clustering is not particularly strong.

    -   Despite the weak strength, the spatial pattern is **statistically significant**, meaning that it is unlikely to occur by chance.

4.  **Standard Deviate: 16.077**

    -   This represents the **standard deviation** of the Moran’s I statistic under random permutations (randomly shuffling the data). A value of 16.077 is quite high, indicating that the observed Moran's I is **far from random** and further supports the finding of significant spatial autocorrelation.

5.  **Sample Estimates:**

    -   **Expectation (-0.0022271715):** This is the expected value of the Moran's I statistic if there were no spatial autocorrelation. It is close to zero, as would be expected under the null hypothesis.

    -   **Variance (0.0001434901):** This is the variance of Moran’s I under random permutations. A small variance suggests a **precise estimate** of Moran's I, further supporting the reliability of the result.

### Conclusion:

The analysis of drug offenses in Thailand using Moran’s I reveals that **drug offenses are spatially clustered**. Provinces with similar drug offense rates tend to be geographically close to each other, even though the strength of the clustering is weak. The results are statistically significant, indicating that this spatial clustering is unlikely to be due to random chance.

This finding suggests that there may be **underlying spatial processes** influencing the distribution of drug offenses, such as proximity to **drug trafficking routes**, local **socioeconomic conditions**, or **regional law enforcement efforts**. Further analysis, such as **local Moran’s I** or **spatial regression**, could provide more insight into specific areas with higher clustering and the factors driving this spatial pattern.

# Local Moran's I (LISA) calculation

```{r}
# Local Moran's I (LISA) calculation
local_moran <- localmoran(combined_province_data$total_offenses, listw)
head(local_moran)
```

**Interpretation of Results:**

-   **Ii values:** Positive values indicate clustering of similar values (hotspots or coldspots), while negative values indicate dispersion of dissimilar values.

-   **Z.Ii and Pr(z != E(Ii))**: High Z-scores and low p-values suggest statistically significant clustering or dispersion.

## Visualisng Local Moran's I (LISA)

```{r}
# Local Moran's I (LISA) calculation
lisa <- localmoran(combined_province_data$total_offenses, listw = weights_list)
combined_province_data$lisa <- lisa[, "Ii"] 
```

```{r}
# Set tmap mode to interactive or static
tmap_mode("plot")  # Use "view" for interactive

# Create a thematic map to visualize Local Moran's I
tm_shape(combined_province_data) +
  tm_polygons("lisa", palette = "viridis", title = "Local Moran's I (LISA)") +
  tm_layout(title = "Local Moran's I (LISA) for Drug Abuse in Thailand Provinces")
```

### Key Observations:

#### 1. **Spatial Clustering:**

-   **Northern Thailand:** Several **hotspots** (areas with higher-than-average drug abuse rates) and **coldspots** (areas with lower-than-average drug abuse rates) are observed. These clusters suggest **significant spatial autocorrelation**, where provinces with high or low drug abuse rates are located near provinces with similar values.

-   **Southern Thailand:** Similar patterns of clustering emerge, with both **hotspots** and **coldspots** present. The distribution indicates the presence of regions with high drug abuse rates concentrated near other regions with similar characteristics.

-   **Central Thailand:** The distribution appears more **scattered**. Clusters are less pronounced, indicating fewer areas where drug abuse rates are spatially concentrated.

#### 2. **Hotspots and Coldspots:**

-   **Hotspots:** These regions, indicated by darker shades, represent areas with **higher drug abuse rates**. These areas exhibit a tendency to cluster geographically with other provinces experiencing similarly high rates. Hotspots are often located near **drug trafficking routes** or regions with **economic and social vulnerabilities**.

-   **Coldspots:** These areas, indicated by lighter shades, represent **lower drug abuse rates**. Coldspots tend to cluster with other provinces with similarly low rates, which may reflect **better law enforcement**, **socioeconomic stability**, or **geographical isolation** from major trafficking routes.

### Potential Explanations and Further Analysis:

#### 1. **Geographical Factors:**

-   Northern Thailand's proximity to **Myanmar and Laos**, both major drug production areas (particularly for methamphetamines), could be influencing the high rates of drug abuse. **Cross-border trafficking** likely contributes to the clustering of hotspots, as these areas may serve as key transit or distribution points.

-   Southern Thailand’s proximity to maritime routes may also influence trafficking patterns, contributing to its observed clustering of drug abuse cases.

#### 2. **Socioeconomic Conditions:**

-   Areas with **high poverty**, **unemployment**, and **limited access to education** are more vulnerable to higher rates of drug abuse. These socioeconomic challenges can create environments where drug trade and use flourish, reinforcing spatial clustering in regions with economic difficulties.

#### 3. **Governance and Law Enforcement:**

-   The effectiveness of local **law enforcement** and **anti-drug initiatives** likely varies across regions. In provinces with stronger law enforcement presence or targeted anti-drug campaigns, drug abuse rates may be lower, leading to the formation of coldspots. Conversely, areas with weaker enforcement may see rising drug abuse, contributing to hotspots.

#### 4. **Drug Production and Trafficking:**

-   **Drug trafficking routes** and **local production** play a significant role in shaping spatial patterns. Regions that lie along key drug trafficking corridors may exhibit clustering of drug abuse, as these areas serve as hubs for drug distribution and consumption. Understanding the types of drugs involved and the logistical routes used for trafficking could provide more context for the clustering observed in Northern and Southern Thailand.

### Conclusion:

The spatial clustering of drug abuse cases in Thailand reflects complex **geopolitical, socioeconomic, and law enforcement dynamics**. Northern and Southern Thailand, in particular, exhibit significant clustering due to their proximity to trafficking routes, while Central Thailand shows a more dispersed pattern.

# Computing Local Moran's I

Learn how to compute Local Moran's I of GDPPC at county level by using local_moran() of sfdep package

```{r}
lisa <- wm_thai_g %>% 
  mutate(local_moran = local_moran(
    total_offenses,nb,wt,nsim=99),
    .before=1) %>% 
  unnest(local_moran)
```

## Visualising local Moran's I

```{r}
tmap_mode('plot')
map1 <- tm_shape(lisa)+
  tm_fill('ii')+
  tm_borders(alpha=0.5)+
  tm_view(set.zoom.limits = c(5,8))+
  tm_layout(
    main.title = "local Moran's I of G",
    main.title.size = 2
  )

map2 <- tm_shape(lisa)+
  tm_fill('p_ii',
          breaks = c(0,0.001,0.01,0.05,1),
          labels = c("0.001","0.01","0.05","Not Sig"))+
  tm_borders(alpha=0.5)+
  tm_layout(
    main.title = "p=value of local Moran's I ",
    main.title.size = 0.8
  )
tmap_arrange(map1,map2,ncol=2)
```

### Key Observations:

#### **Map 1: Local Moran's I (Ii)**

-   **Spatial Clustering:**

    -   The map reveals distinct areas of spatial clustering, where values of Local Moran's I indicate regions with either high or low drug abuse rates that tend to cluster together. This suggests **significant spatial autocorrelation** in drug abuse patterns across the provinces.

-   **Hotspots (High-High Clusters):**

    -   Provinces shaded darker (values 4 to 5) are indicative of **high drug abuse rates** clustering with other provinces experiencing similarly high rates. These areas may represent key locations for **drug trafficking routes**, high consumption, or poor enforcement.

-   **Coldspots (Low-Low Clusters):**

    -   Lighter shaded provinces (values 1 to 0) signify **low drug abuse rates** clustering with other regions of low rates. These provinces could reflect areas with **effective law enforcement**, **strong social infrastructure**, or **limited access** to drugs.

#### **Map 2: p-value of Local Moran's I (p_ii)**

-   **Statistical Significance:**

    -   The second map showcases provinces where the Local Moran's I is **statistically significant**, meaning the spatial clustering observed is unlikely due to random chance. P-values below **0.05** (shaded regions) mark areas where we have confidence in the clustering observed in **Map 1**.

-   **Significant Clusters:**

    -   Provinces with p-values below 0.05 (and even lower thresholds of 0.01 and 0.001) are areas with statistically significant spatial clustering. These regions can be considered **true hotspots or coldspots**, where drug abuse rates are influenced by strong spatial relationships and not random occurrences.

### **Combined Analysis:**

By examining **both maps**, we gain deeper insights into spatial patterns of drug abuse:

-   **Identifying Strong Hotspots/Coldspots:**

    -   Provinces that show both **high Local Moran's I values** (darker shades in Map 1) and **low p-values** (significance in Map 2) represent **strong hotspots** of drug abuse. These provinces are not only clustering geographically with high rates but are also statistically significant, meaning this clustering is robust.

    -   Similarly, **coldspots** identified in both maps represent regions where **low drug abuse rates** are geographically clustered with statistical significance.

-   **Policy Implications:**

    -   **Hotspot provinces** may require **enhanced law enforcement**, **social interventions**, and **anti-drug campaigns**, as they are areas with high and concentrated drug abuse.

    -   **Coldspot provinces** may serve as **models** for effective governance, law enforcement, or social strategies that could be replicated in higher-risk areas.

### Conclusion:

The combined use of Local Moran's I and its corresponding p-values provides a powerful tool to understand the spatial dynamics of drug abuse in Thailand. Provinces with both high Local Moran's I and statistically significant p-values represent **critical areas** for focused interventions, whether they be law enforcement or socioeconomic support measures. This dual analysis helps to prioritize regions where drug abuse is not only high but spatially concentrated and significant.

# Visualisng LISA map

```{r}
lisa_sig <- lisa %>% 
  filter(p_ii < 0.05)

tmap_mode("plot")
tm_shape(lisa)+
  tm_polygons()+
  tm_borders(alpha=0.5)+
  tm_shape(lisa_sig)+
  tm_fill("mean")+
  tm_borders(alpha=0.4)
```

### Key Observations:

#### **Spatial Clustering:**

-   The map demonstrates **significant spatial clustering** in the distribution of drug abuse rates across provinces. This clustering is identified using **Local Moran's I**, a measure that highlights how similar values (high or low rates) are distributed geographically.

#### **High-High Clusters:**

-   **Northern and Southern regions** of Thailand show notable **high-high clusters**, where provinces with **high drug abuse rates** are surrounded by other high-rate provinces. This indicates that drug abuse is not only prevalent in these regions but also **spatially concentrated**, possibly due to factors such as proximity to drug trafficking routes, limited law enforcement, or socioeconomic challenges.

#### **Low-Low Clusters:**

-   Certain provinces in **central and southern Thailand** exhibit **low-low clusters**, meaning that provinces with **low drug abuse rates** tend to be adjacent to other provinces with similarly low rates. These areas may benefit from more **effective governance, law enforcement**, or **better socioeconomic conditions** that help suppress drug-related activities.

#### **Mixed Clusters (Low-High, High-Low):**

-   **Mixed clusters**, where provinces with **low drug abuse rates** are adjacent to provinces with **high rates** (low-high) and vice versa (high-low), indicate **complex spatial relationships**. These areas may be experiencing **border effects** where the spillover of drug abuse from neighboring high-rate provinces contrasts with local conditions, or they may reflect **transitional zones** influenced by different local policies, economic conditions, or enforcement strength.

### **Implications:**

The spatial patterns observed through **Local Moran's I** provide important insights into the **geographical spread of drug abuse** in Thailand.

-   **High-High clusters** represent critical areas for **targeted intervention** such as increased law enforcement, border control, or community-based prevention programs.

-   **Low-Low clusters** could serve as examples of **effective policy and enforcement** that might be studied and replicated in high-risk areas.

-   **Mixed clusters** demand further investigation to understand why neighboring provinces with drastically different drug abuse rates are in close proximity, potentially guiding more tailored local strategies.

## **Global Measures of Spatial Autocorrelation: Geary’s C**

```{r}
geary.test(combined_province_data$total_offenses, listw=weights_list)
```

**Output Interpretation:**

-   **Geary C statistic:** 0.87943531 - This value suggests a moderate positive spatial autocorrelation. It means that provinces with higher rates of total offenses tend to be located near other provinces with higher rates.

-   **Standard deviate:** 3.8101 - This is the standard deviation of the Geary's C statistic under random permutations. It provides a measure of variability around the expected value of 1 under no autocorrelation.

-   **p-value:** 6.945e-05 - This small p-value indicates that the observed Geary's C statistic is unlikely to occur by chance if there were no spatial autocorrelation. It provides evidence for the existence of spatial clustering in the data.

-   **Alternative hypothesis:** Expectation greater than statistic - This indicates that the alternative hypothesis is that the expected value of Geary's C is greater than the observed statistic, suggesting positive spatial autocorrelation.

-   **Sample estimates:**

    -   **Expectation:** 1.00000000 - This is the expected value of Geary's C under random permutations.

    -   **Variance:** 0.00100129 - This is the variance of Geary's C under random permutations.

**Conclusion:**

The analysis suggests that there is a moderate positive spatial autocorrelation in the distribution of total offenses across the provinces in the dataset. This means that provinces with higher rates of total offenses tend to be clustered together geographically. This finding may be indicative of underlying spatial processes or factors that influence the distribution of total offenses.

```{r}
set.seed(1234)
bperm_GC=geary.mc(combined_province_data$total_offenses, 
               listw=weights_list, 
               nsim=999)
bperm_GC
```

`set.seed(1234)`: This sets the random seed to ensure reproducibility of the results.

### **Output Interpretation:**

#### **Geary's C Statistic:**

-   **Value: 0.87943531** - The Geary's C value is less than 1, suggesting **moderate positive spatial autocorrelation**. This means that provinces with higher rates of drug offenses are located near other provinces with similarly higher rates, though the clustering is less pronounced compared to Moran's I.

#### **Standard Deviate:**

-   **3.8101** - This is the **Z-score** or standard deviation of the Geary’s C statistic. A Z-score greater than 2 typically indicates a significant result, and 3.8101 shows a strong deviation from what is expected under random distribution, reinforcing the presence of spatial autocorrelation.

#### **p-value:**

-   **6.945e-05** - The p-value is extremely small, indicating that the probability of observing this spatial clustering by chance is negligible. Therefore, there is **strong evidence** that spatial clustering exists in the data.

#### **Alternative Hypothesis:**

-   **Expectation greater than statistic** - This indicates that the observed value of Geary's C is lower than its expected value of 1, suggesting **positive spatial autocorrelation**.

#### **Sample Estimates:**

-   **Expectation: 1.00000000** - This is the expected value of Geary's C under the assumption of no spatial autocorrelation.

-   **Variance: 0.00100129** - This is the variance around the expected value of Geary's C, used to determine the significance of the observed statistic.

### **Conclusion:**

The results from the Geary's C statistic suggest **moderate positive spatial autocorrelation** in the distribution of drug offenses across provinces. This means that **provinces with higher drug offense rates** tend to be **geographically clustered** together, but the clustering is more localized than in the case of Moran's I. This finding highlights the existence of **regional influences**—such as **drug trafficking routes, socioeconomic conditions, or enforcement practices**—that affect neighboring provinces similarly.

Understanding these spatial patterns can guide **targeted interventions** by focusing resources in clustered regions and exploring how neighboring areas influence each other in the context of drug offenses.

```{r}
hist(bperm_GC$res, freq=TRUE, breaks=20, xlab="Simulated Geary c")
abline(v=1, col="red") 
```

### **Key Observations:**

#### **Distribution:**

-   The histogram of simulated Geary's C values shows a roughly **bell-shaped** (normal) distribution, meaning that most of the simulated values are close to a central value, and fewer values appear at the extremes.

#### **Central Tendency:**

-   The distribution is centered around a value **slightly greater than 1.0**, which is the expected value of Geary’s C under the assumption of no spatial autocorrelation. This suggests that, under random spatial configurations, the majority of simulated values align with the null hypothesis (no autocorrelation).

#### **Spread:**

-   The relatively **narrow spread** of the distribution indicates that the simulated Geary’s C values are not highly dispersed, which is expected in the Monte Carlo permutation process. Most simulated values are clustered around the central value with limited deviation.

#### **Observed Statistic:**

-   The **red vertical line** on the histogram represents the **observed Geary’s C statistic**. Its position in the **right tail** of the distribution indicates that the observed statistic is relatively **high compared to the majority of simulated values**.

### **Interpretation:**

-   **Normality:** The approximately normal distribution of simulated Geary's C values demonstrates that the **Monte Carlo permutation test** is valid, reinforcing the **reliability of the p-value** associated with this test.

-   **Central Tendency:** The fact that most simulated values are near 1.0 confirms that the **expected value of Geary's C** under random permutations is around 1.0, corresponding to **no spatial autocorrelation**.

-   **Spread:** The **narrow distribution** suggests that the simulated values have a **low level of dispersion**, further supporting the statistical robustness of the test.

-   **Observed Statistic:** The position of the observed Geary's C statistic in the **right tail** of the distribution indicates that it is **significantly higher than the majority of simulated values**. This strongly supports the conclusion that the observed spatial autocorrelation is **unlikely to have occurred by chance**.

### **Conclusion:**

The histogram provides **clear visual evidence** of the statistical significance of the observed Geary's C statistic. The **simulated values are normally distributed** around 1.0, with the observed Geary’s C falling in the **right tail** of the distribution. This indicates that the observed spatial autocorrelation is **significant and unlikely to occur randomly**, supporting the finding of **positive spatial autocorrelation** in the dataset.

```{r}
set.seed(1234)
bperm= moran.mc(combined_province_data$total_offenses, 
                listw=weights_list, 
                nsim=999, 
                zero.policy = TRUE, 
                na.action=na.omit)
bperm
```

Similiarly, function `moran.mc` performs a Monte Carlo permutation test to assess the statistical significance of the observed Moran's I statistic.

### **Output Interpretation:**

1.  **Monte Carlo Simulation of Moran's I:**

    -   This indicates that a **Monte Carlo permutation test** was conducted to evaluate the **statistical significance** of the Moran's I statistic, which measures spatial autocorrelation.

2.  **Data: combined_province_data\$total_offenses:**

    -   The variable of interest in the analysis is **total_offenses**, representing the total number of drug offenses across the provinces.

3.  **Weights: weights_list:**

    -   The spatial weights matrix used for the analysis is designated as **weights_list**, which defines the spatial relationships between the provinces.

4.  **Number of Simulations + 1: 1000:**

    -   A total of **1000 simulations** were performed, including one for the observed data. This number indicates the robustness of the statistical assessment, as a higher number of simulations generally increases reliability.

5.  **Statistic = 0.19036:**

    -   The **observed Moran's I statistic** is **0.19036**. This value suggests a **weak positive spatial autocorrelation**, indicating that provinces with higher drug offense rates tend to be clustered together.

6.  **Observed Rank 1000:**

    -   This indicates that the **observed Moran's I statistic** is the **largest** among all 1000 simulated values, suggesting a strong deviation from randomness in the observed data.

7.  **p-value = 0.001:**

    -   The **p-value** of **0.001** indicates that the observed Moran's I statistic is **highly unlikely to occur by chance** if there were no spatial autocorrelation. This small p-value provides **strong evidence** for the existence of spatial clustering in the drug offense data.

8.  **Alternative Hypothesis: Greater:**

    -   The alternative hypothesis states that the expected value of Moran's I is greater than the observed statistic. This implies that the analysis is specifically testing for **positive spatial autocorrelation** in the data.

### **Conclusion:**

The output indicates that the **Monte Carlo permutation test** has provided robust statistical evidence supporting the existence of **positive spatial autocorrelation** in the distribution of drug offenses across provinces. The **observed Moran's I statistic** of **0.19036**, combined with the **p-value of 0.001**, strongly suggests that provinces with higher drug offenses tend to cluster together, rather than being distributed randomly. This finding can inform further investigations into the factors contributing to this spatial pattern.

```{r}
mean(bperm$res[1:999])
```

```{r}
hist(bperm$res, 
     freq=TRUE, 
     breaks=20, 
     xlab="Simulated Moran's I")
abline(v=0, 
       col="red") 
```

### **Key Observations:**

1.  **Distribution:**

    -   The histogram displays a **right-skewed distribution**, indicating a longer tail on the right side. This suggests that the simulated Moran's I values are more frequently higher than the mean.

2.  **Central Tendency:**

    -   The distribution appears to be centered around a value slightly greater than **0**, implying that most simulated values cluster close to **0**. This is consistent with the expectation of no spatial autocorrelation.

3.  **Spread:**

    -   The distribution is **relatively wide**, suggesting that the simulated Moran's I values are dispersed over a broader range. This indicates variability in the spatial autocorrelation across the simulations.

4.  **Observed Statistic:**

    -   The **red vertical line**, representing the observed Moran's I statistic, is located towards the **right tail** of the distribution. This indicates that the observed value is relatively high compared to the majority of the simulated values.

### **Interpretation:**

1.  **Skewness:**

    -   The **right-skewed distribution** suggests that there are some simulated values significantly higher than the others. This could be attributed to the presence of **strong spatial clusters** or other influential factors affecting the distribution of Moran's I.

2.  **Central Tendency:**

    -   The clustering of most simulated values around **0** indicates that under random permutations, the Moran's I statistic tends to be near **0**, which aligns with the null hypothesis of no spatial autocorrelation.

3.  **Spread:**

    -   The **relatively wide distribution** suggests that while the values cluster around the center, they also exhibit variability. This is expected in a Monte Carlo permutation test, where randomness can produce a range of outcomes.

4.  **Observed Statistic:**

    -   The position of the observed Moran's I statistic in the **right tail** signifies that it is notably different from the simulated values, reinforcing the notion that the observed spatial autocorrelation is unlikely to result from random chance.

### **Conclusion:**

The histogram visually substantiates the statistical significance of the observed Moran's I statistic. The **right-skewed distribution** of simulated values indicates that the observed Moran's I is comparatively high relative to the majority of simulated outcomes. This supports the conclusion of **positive spatial autocorrelation** in the dataset, suggesting that areas with higher drug offenses are clustered together rather than randomly distributed. This insight can guide further exploration into the underlying factors influencing these spatial patterns.

#### Mapping the local Moran’s I

Before mapping the local Moran’s I map, it is wise to append the local Moran’s I dataframe (i.e. localMI) onto hunan SpatialPolygonDataFrame. The code chunks below can be used to perform the task. The out SpatialPolygonDataFrame is called *province.localMI*.

```{r}
province.localMI <- cbind(combined_province_data,local_moran) %>%
  rename(Pr.Ii = Pr.z....E.Ii..)
```

Using choropleth mapping functions of **tmap** package, we can plot the local Moran’s I values by using the code chunks below.

```{r}
tm_shape(province.localMI) +
  tm_fill(col = "Ii", 
          style = "pretty",
          palette = "RdBu",
          title = "local moran statistics") +
  tm_borders(alpha = 0.5)
```

### **Key Observations:**

1.  **Spatial Clustering:**

    -   The map effectively illustrates **distinct clusters** of provinces based on the Local Moran's I statistic, suggesting significant **spatial autocorrelation** in the distribution of the variable, likely related to drug offenses.

2.  **Hotspots and Coldspots:**

    -   **Hotspots:** Provinces in the **northern** and **southern regions** are marked with darker shades, indicating that these areas have high values of the variable and are surrounded by other regions with similarly high values.

    -   **Coldspots:** In contrast, certain provinces in the **central** and **southern regions** exhibit lighter shades, suggesting they have low values and are also surrounded by other low-value areas.

3.  **Mixed Clusters:**

    -   The presence of **mixed clusters** (e.g., low-high or high-low) indicates **complex spatial relationships**, highlighting areas where drug offenses may not follow simple patterns of high or low values.

### **Potential Explanations and Further Analysis:**

Given the context of drug offenses in Thailand, several factors may contribute to these observed patterns:

1.  **Geographical Factors:**

    -   The **proximity to borders** with countries like Myanmar and Laos may significantly influence drug trafficking routes. This geographical positioning can lead to concentrated areas of drug activity, forming the identified hotspots.

2.  **Socioeconomic Conditions:**

    -   Areas with **higher poverty rates**, **unemployment**, and a **lack of educational opportunities** may correlate with increased rates of drug offenses. These socioeconomic challenges can foster environments conducive to drug-related activities.

3.  **Governance and Law Enforcement:**

    -   Variations in the **effectiveness of law enforcement** and anti-drug initiatives across regions can impact how drug offenses are distributed spatially. Regions with stronger law enforcement may show lower rates of drug offenses, contributing to the coldspots.

4.  **Drug Production and Trafficking:**

    -   Understanding the specific **types of drugs** involved in the offenses and their **production and trafficking routes** can provide deeper insights into the observed spatial patterns. Certain drugs may be more prevalent in specific areas, influenced by local production capabilities and trafficking networks.

### **Conclusion:**

The map serves as a valuable visual tool for understanding the **spatial distribution** of drug offenses in Thailand and the **statistical significance** of the identified clusters. By closely examining the hotspots and coldspots, researchers and policymakers can better understand the underlying factors that drive these patterns. This knowledge can inform **targeted interventions** to effectively address the drug problem, tailoring strategies to the specific needs and conditions of different regions.

# Computing local Gi\* statistics

need to derive a spatial weight matrix before we can compute local Gi\* statistics. Code chunk below will be used to derive a spatial weight matrix by using sfdep functions and tidyverse approach

```{r}
#|eval: false
wm_thai <- combined_province_data %>% 
  mutate(nb=st_contiguity(geometry),
         wts = st_inverse_distance(nb,geometry,
                                   scale=1,
                                   alpha=1),
         .before = 1)
```

### Save Derived data

```{r}
write_rds(wm_thai,"data/rds/wm_thai.rds")
```

### Read Derived data

```{r}
wm_thai<- read_rds("data/rds/wm_thai.rds")
```

```{r}
HCSA <- wm_thai %>% 
  mutate(local_Gi = local_gstar_perm(
    total_offenses,nb,wt,nsim=99),
    .before=1) %>% 
      unnest(local_Gi)
```

```{r}
HCSA_sig <- HCSA %>% 
  filter(p_sim<0.05)
tmap_mode("plot")
tm_shape(HCSA)+
  tm_polygons()+
  tm_borders(alpha=0.5)+
tm_shape(HCSA_sig)+
  tm_fill("gi_star")+
  tm_borders(alpha=0.4)
```

### **Key Observations:**

1.  **Spatial Clustering:**

    -   The map effectively illustrates **significant spatial clustering** of drug abuse cases across Thailand. Distinct **hotspots** and **coldspots** are clearly visible, indicating areas with concentrated levels of drug abuse.

2.  **Hotspots:**

    -   Provinces located in the **northern** and **southern regions** display higher **Geary's I values**, signifying **stronger spatial autocorrelation**. This suggests that these areas likely have higher levels of drug abuse clustered together, which could be indicative of localized issues.

3.  **Coldspots:**

    -   In contrast, some provinces in the **central region** exhibit **lower Geary's I values**. This may imply **weaker spatial autocorrelation** and potentially lower levels of drug abuse, or more dispersed patterns of drug use.

### **Potential Explanations and Further Analysis:**

1.  **Geographical Factors:**

    -   The **proximity to borders** with neighboring countries, such as **Myanmar** and **Laos**, may significantly influence drug trafficking routes. This geographic positioning could facilitate drug flow and contribute to the observed clustering of drug abuse cases in those regions.

2.  **Socioeconomic Conditions:**

    -   **Poverty**, **unemployment**, and a **lack of educational opportunities** are factors that may correlate with increased drug abuse rates. Regions facing these socioeconomic challenges could see higher levels of clustering as individuals may turn to substance abuse in the absence of viable opportunities.

3.  **Governance and Law Enforcement:**

    -   Variations in the **effectiveness of law enforcement** agencies and anti-drug initiatives across different provinces could impact the **spatial distribution** of drug abuse. Regions with stronger enforcement might exhibit lower rates of drug abuse due to proactive measures, while areas with lax enforcement could show increased clustering.

4.  **Drug Production and Trafficking:**

    -   Gaining insights into the specific **types of drugs** involved and their respective **production and trafficking routes** could illuminate the spatial patterns of drug abuse. Understanding these dynamics may reveal underlying factors contributing to the clustering seen in the hotspots.

### **Conclusion:**

The map serves as an invaluable tool for visualizing the **spatial distribution** of drug abuse in Thailand, highlighting the **statistical significance** of the identified clusters. By analyzing the **hotspots** and **coldspots**, researchers and policymakers can better understand the complex interplay of factors driving these patterns. This understanding can lead to the development of **targeted interventions** that address the specific needs of affected regions, ultimately aiding in the fight against drug abuse in Thailand.

# Conclusion and Reflection

The spatial analysis of drug abuse indicators across Thailand reveals significant regional variations in drug offenses, highlighting the impact of Thailand's geographical proximity to the Golden Triangle, a notorious drug production area. Provinces near this region exhibit higher rates of drug-related offenses, underscoring their role as both consumption areas and transit hubs for drug trafficking. The use of spatial autocorrelation methods, such as global and local Moran's I, confirmed clusters of high drug offenses in these provinces. This suggests that drug-related activities are not randomly distributed but are spatially concentrated in specific areas.

The findings further emphasize the vulnerability of certain provinces, particularly those with strong transportation links and infrastructure developments, which facilitate the movement of drugs. The high concentration of drug offenses among youth, especially vocational school students, calls for targeted intervention programs aimed at this demographic.

### Reflection

This assignment underscored the importance of using spatial analysis tools to understand the geographic distribution of social issues like drug abuse. By applying techniques such as spatial autocorrelation, we gained insights into the areas most affected by drug trafficking and consumption in Thailand. The data-driven approach helps inform policy decisions and resource allocation, allowing authorities to focus on high-risk regions and populations.

The exercise also illustrated the complexity of addressing drug abuse in Thailand, as it is influenced by a combination of geopolitical factors, infrastructural developments, and socio-economic conditions. Future studies could explore the relationship between drug offenses and other socio-economic variables, such as income levels, education, and employment, to further refine prevention strategies. Overall, spatial analysis provided a valuable lens through which to examine drug-related issues and supports the development of more effective, geo graphically targeted interventionss
