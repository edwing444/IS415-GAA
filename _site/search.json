[
  {
    "objectID": "In_Class_Excercise/In_Class_Ex4/In_Class_Ex4.html",
    "href": "In_Class_Excercise/In_Class_Ex4/In_Class_Ex4.html",
    "title": "In Class Exercise 4",
    "section": "",
    "text": "Loading R packages\n\npacman::p_load(sf, raster, spatstat, tmap, tidyverse,sparr)\n\n\n\nImporting and preparing study area\n\nkbb &lt;- st_read(dsn=\"data/rawdata\",\n               layer =\"Kepulauan_Bangka_Belitung\")\n\nReading layer `Kepulauan_Bangka_Belitung' from data source \n  `C:\\edwing444\\IS415-GAA\\In_Class_Excercise\\In_Class_Ex4\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 298 features and 27 fields\nGeometry type: POLYGON\nDimension:     XYZ\nBounding box:  xmin: 105.1085 ymin: -3.116593 xmax: 106.8488 ymax: -1.501603\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n\n\nRevise code\n\nkbb_sf &lt;- st_read(dsn=\"data/rawdata\",\n               layer =\"Kepulauan_Bangka_Belitung\") %&gt;% \n  st_union() %&gt;% #to dissovle\n  st_zm(drop=TRUE,what=\"ZM\") %&gt;% #to drop the z from polygon\n  st_transform(crs=32748)\n\nReading layer `Kepulauan_Bangka_Belitung' from data source \n  `C:\\edwing444\\IS415-GAA\\In_Class_Excercise\\In_Class_Ex4\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 298 features and 27 fields\nGeometry type: POLYGON\nDimension:     XYZ\nBounding box:  xmin: 105.1085 ymin: -3.116593 xmax: 106.8488 ymax: -1.501603\nz_range:       zmin: 0 zmax: 0\nGeodetic CRS:  WGS 84\n\n\nst_as_s2(): dropping Z and/or M coordinate\n\n\n\n\nConverting OWIN\n\nkbb_owin&lt;-as.owin(kbb_sf)\nkbb_owin\n\nwindow: polygonal boundary\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n\n\nclass() to confirm output is owin\n\nclass(kbb_owin)\n\n[1] \"owin\"\n\n\n\n\nImport forest fire data\n\nfire_sf&lt;-read.csv(\"data/rawdata/forestfires.csv\") %&gt;% \n  st_as_sf(coords = c(\"longitude\",\"latitude\"),\n           crs=4326) %&gt;% \n  st_transform(crs=32748)\n\nbecause ppp object only accept numerical or character as mark, the code below is used to convert acq_date to numeric\n\nfire_sf&lt;-fire_sf %&gt;% \n  mutate(DayofYear = yday(acq_date)) %&gt;% \n  mutate(Month_num = month(acq_date)) %&gt;% \n  mutate(Month_fac = month(acq_date,\n                           label = TRUE,\n                           abbr = FALSE))\n\n\n\nVisualising\n\ntm_shape(kbb_sf)+\n  tm_polygons()+\n  tm_shape(fire_sf)+\n  tm_dots()\n\n\n\n\n\n\n\n\n\nVisualing by month\n\ntm_shape(kbb_sf)+\n  tm_polygons()+\n  tm_shape(fire_sf)+\n  tm_dots(size=0.1)+\n  tm_facets(by=\"Month_fac\",\n            free.coords = FALSE,#if true, zoom to where the data points are\n            drop.units = TRUE)\n\n\n\n\n\n\n\n\n\n\n\nComputing STKDE by Month\nThe code below remove the unwanted fields form fire_sf. This is because as.ppp() on need the mark field and geometry field from the input sf.dataframe\n\nfire_month&lt;-fire_sf %&gt;% \n  select(Month_num)\n\nThe code below is used to derive ppp object call fire_month from fire_month sf dataframe\n\nfire_month_ppp &lt;- as.ppp(fire_month)\nfire_month_ppp\n\nMarked planar point pattern: 741 points\nmarks are numeric, of storage type  'double'\nwindow: rectangle = [521564.1, 695791] x [9658137, 9828767] units\n\n\nthe code below combine origin_am_ppp and am_owin objects into one\n\nfire_month_owin &lt;-fire_month_ppp[kbb_owin]\nsummary(fire_month_owin)\n\nMarked planar point pattern:  741 points\nAverage intensity 6.424519e-08 points per square unit\n\nCoordinates are given to 10 decimal places\n\nmarks are numeric, of type 'double'\nSummary:\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  1.000   8.000   9.000   8.579  10.000  12.000 \n\nWindow: polygonal boundary\n2 separate polygons (no holes)\n           vertices        area relative.area\npolygon 1     47493 11533600000      1.00e+00\npolygon 2       256      306427      2.66e-05\nenclosing rectangle: [512066.8, 705559.4] x [9655398, 9834006] units\n                     (193500 x 178600 units)\nWindow area = 11533900000 square units\nFraction of frame area: 0.334\n\n\n\n\nComputing STKDE\nspattemp_density() of sparr is used to compute STKDE\n\nst_kde &lt;- spattemp.density(fire_month_owin)\n\nCalculating trivariate smooth...Done.\nEdge-correcting...Done.\nConditioning on time...Done.\n\n\n\nsummary(st_kde)\n\nSpatiotemporal Kernel Density Estimate\n\nBandwidths\n  h = 15102.47 (spatial)\n  lambda = 0.0304 (temporal)\n\nNo. of observations\n  741 \n\nSpatial bound\n  Type: polygonal\n  2D enclosure: [512066.8, 705559.4] x [9655398, 9834006]\n\nTemporal bound\n  [1, 12]\n\nEvaluation\n  128 x 128 x 12 trivariate lattice\n  Density range: [1.233458e-27, 8.202976e-10]\n\n\n\nPlotting STKDE object\nin the code below, plot() of R base is used to the KDE between july 2023-december 2023\n\ntims &lt;- c(7,8,9,10,11,12)\npar(mfcol=c(2,3))#2rows,3 col\nfor (i in tims){\n  plot(st_kde,i,\n       override.par=FALSE,\n       fix.range=TRUE,\n       main=paste(\"KDE at month\",i))\n}"
  }
]